# Умная система для дома - Обзор монолитной архитектуры

## Язык программирования

Приложение разработано на языке **Java**, что позволяет использовать преимущества сильной типизации, масштабируемости и совместимости с популярными фреймворками, такими как Spring Framework.

## База данных

Используется **PostgreSQL** в качестве реляционной базы данных. Это предоставляет широкие возможности для хранения данных с поддержкой транзакций и сложных запросов.

## Общая архитектура

Архитектура приложения — **монолитная**, что означает, что следующие компоненты находятся в рамках одного приложения:

- Обработка HTTP-запросов,
- Бизнес-логика управления устройствами и мониторинга,
- Работа с данными через базу данных.

## Взаимодействие

Взаимодействие между компонентами приложения осуществляется **синхронно**. Запросы обрабатываются последовательно, что может ограничивать производительность при высоких нагрузках.

## Масштабируемость

**Масштабируемость** монолита ограничена. Для увеличения производительности необходимо масштабировать все приложение целиком, что делает масштабирование менее гибким и более затратным.

## Развертывание

При любом обновлении требуется **полное перезапуск приложения**, что увеличивает время простоя при внесении изменений.

## Доменная модель

Для упрощения управления и улучшения понимания системы выделены основные **домены** и **границы контекстов**:

### 1. Домен «Управление устройствами»

- **Описание**: Управление устройствами умного дома, такими как отопительные приборы и температурные датчики.
- **Граница контекста**: Взаимодействие с IoT-устройствами через протоколы (например, MQTT или HTTP API).
- **Основная логика**:
  - Отправка команд устройствам (включение/выключение).
  - Мониторинг состояния устройств.

### 2. Домен «Мониторинг температуры»

- **Описание**: Обработка данных, полученных от температурных датчиков, для управления системой отопления.
- **Граница контекста**: Взаимодействие с температурными датчиками для получения текущих данных.
- **Основная логика**:
  - Сбор данных телеметрии.
  - Принятие решений на основе полученной информации.

### 3. Домен «Управление пользователями»

- **Описание**: Управление пользователями системы, их правами и ролями.
- **Граница контекста**: Хранение данных пользователей в базе данных PostgreSQL.
- **Основная логика**:
  - Аутентификация и авторизация пользователей.
  - Управление учетными записями и ролями.

### 4. Домен «Сценарии автоматизации»

- **Описание**: Создание автоматизированных сценариев для управления отоплением в зависимости от условий.
- **Граница контекста**: Выполнение сценариев на основе данных с устройств.
- **Основная логика**:
  - Определение условий срабатывания.
  - Управление устройствами в зависимости от сценариев.

## Преимущества и недостатки

### Преимущества:

- Приложение проще в разработке и тестировании, поскольку все компоненты находятся в одном проекте.
- Использование проверенных технологий, таких как Spring и PostgreSQL.

### Недостатки:

- Ограниченная масштабируемость. Для увеличения производительности необходимо масштабировать весь монолит целиком.
- Трудности с обновлением. Любые изменения требуют полного перезапуска системы, что увеличивает время простоя.

## Рекомендации по улучшению

- Рассмотреть возможность разделения на микросервисы для повышения масштабируемости в будущем.
- Оптимизировать процесс развертывания, чтобы минимизировать время простоя.

# Умная система для дома - Обзор микросервисной архитектуры

## Общий обзор

Этот документ описывает архитектуру будущей **умной системы для дома**, которая будет модульной, масштабируемой и гибкой платформой, позволяющей пользователям удалённо управлять своим домом и контролировать его. Система состоит из нескольких микросервисов и использует современные облачные подходы, такие как событийно-ориентированная архитектура, контейнеризация и CI/CD пайплайны для автоматизации процессов.

## Основные функции

- **Модульная система**: Платформа построена из независимых микросервисов, каждый из которых отвечает за определённую функциональность (например, управление устройствами, контроль отопления, безопасность, освещение и т.д.).
- **Самообслуживание пользователей**: Пользователи могут управлять своими устройствами, настраивать сценарии автоматизации и просматривать данные телеметрии от подключённых устройств.
- **Событийно-ориентированная архитектура**: Взаимодействие между микросервисами происходит с использованием потоков событий (Apache Kafka), что обеспечивает высокую развязанность и гибкость системы.
- **Облачная инфраструктура**: Все микросервисы будут контейнеризованы с использованием Docker и оркестрироваться через Kubernetes для упрощённого развертывания и управления.
- **Поддержка различных устройств**: Система поддерживает интеграцию с устройствами сторонних производителей через стандартные IoT-протоколы, что позволяет пользователям подключать и управлять различными модулями умного дома.

## Основные компоненты

1. **API Gateway**: Является единым входом для всех запросов клиентов и маршрутизирует их к соответствующим микросервисам. Основан на **Spring Cloud Gateway**.
2. **Сервисы управления устройствами**:
   - **Device Management Service**: Отвечает за регистрацию, управление состоянием и мониторинг всех подключённых устройств. Поддерживает взаимодействие с устройствами через IoT-протоколы.
   - **Heating Control Service**, **Lighting Control Service**, **Security Service**: Микросервисы, отвечающие за управление конкретными категориями устройств (отопление, освещение, безопасность).
3. **Сервис телеметрии**: Отвечает за сбор, хранение и обработку данных от датчиков (телеметрии). Включает в себя как последние данные, так и исторические данные.
4. **Сервис управления сценариями**: Позволяет пользователям создавать автоматизированные сценарии для управления устройствами в зависимости от различных условий.
5. **Сервис уведомлений**: Отправляет пользователям уведомления о важных событиях и изменениях в системе (например, изменение статуса устройства, триггеры сценариев и т.д.).

## Взаимодействие между сервисами

Вся система построена на принципах микросервисной архитектуры, где каждый сервис может общаться друг с другом через события, публикуемые в **Apache Kafka**. Это обеспечивает гибкость и отказоустойчивость, так как сервисы могут работать независимо друг от друга.

- **Kafka** используется для передачи событий между сервисами (например, изменение состояния устройства, активация сценариев и т.д.).
- **PostgreSQL** служит основной базой данных для хранения информации о пользователях, устройствах, телеметрии и сценариях.

## Архитектура данных

- **База данных**: Для хранения данных используется **PostgreSQL**. Каждая микрослужба управляет своим набором данных через собственные репозитории.
- **Телеметрия**: Данные от устройств собираются в режиме реального времени и хранятся для дальнейшего анализа и построения исторических данных.

## CI/CD и контейнеризация

Для упрощения процессов разработки и развертывания система использует:

- **Контейнеризация**: Все микросервисы будут развернуты в контейнерах **Docker**.
- **Оркестрация**: Управление контейнерами осуществляется с помощью **Kubernetes**, что позволяет легко масштабировать систему по мере увеличения нагрузки.
- **CI/CD пайплайны**: Автоматизация сборки, тестирования и развертывания системы с использованием популярных инструментов CI/CD (например, Jenkins, GitLab CI).

## Заключение

Целевая архитектура умной системы для дома спроектирована для поддержки множества домов и устройств, обеспечивая гибкость, масштабируемость и лёгкость в использовании. Пользователи смогут самостоятельно управлять устройствами, настраивать сценарии автоматизации и получать телеметрию в режиме реального времени, в то время как вся инфраструктура будет поддерживаться через микросервисы и облачные технологии.
